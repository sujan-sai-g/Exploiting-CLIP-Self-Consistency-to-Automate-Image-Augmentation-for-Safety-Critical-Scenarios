import pandas as pd


def merge_files(args):
    try:
        metadata_df = pd.read_csv(args.csv_outputs + "cityscapes_generated_gt_metadata_cleaned.csv")
    except FileNotFoundError:
        print("metadata file missing")
    metadata_df = metadata_df.sort_values(by=["Filename"])
    
    try:
        gt_bbox_df = pd.read_csv(args.csv_outputs + "cityscapes_generated_gtbboxes.csv")
    except FileNotFoundError:
        print("gt file missing")
    gt_bbox_df = gt_bbox_df.sort_values(by=["Filename"])

    try:
        gen_metadata_df = pd.read_csv(args.csv_outputs + "generated_cityscapes_metadata.csv")
    except FileNotFoundError:
        print("preds file missing")
    gen_metadata_df = gen_metadata_df.sort_values(by=["Filename"])

    df_merge_1 = pd.merge(
        left=metadata_df,
        right=gt_bbox_df,
        how="inner",
        # outer to have false positives and false negatives both
        left_on=["Filename"],
        right_on=["Filename"],
    )

    df_merge_2 = pd.merge(
        left=gen_metadata_df,
        right=df_merge_1,
        how="outer",
        # outer to have false positives and false negatives both
        left_on=["Filename"],
        right_on=["Filename"],
    )

    df_merge_2.to_csv(args.csv_outputs + "full_merge_file.csv")
