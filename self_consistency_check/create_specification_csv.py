import glob
import pandas as pd
import tqdm


def create_gt_metadata_csv(args):
    filenames = glob.glob(args.generated_image_folder_path + "*.png")
    age_list = []
    gender_list = []
    skincolor_list = []
    shirtcolor_list = []
    action_list = []
    filename_list = []

    # orientation_info_list = []
    for sg_file in tqdm.tqdm(filenames):
        filename_list.append('_'.join(sg_file.split("/")[-1].split("_")[0:4]).split(".")[0].split("-")[-1])

        age_list.append(sg_file.split("/")[-1].split("_")[4])
        gender_list.append(sg_file.split("/")[-1].split("_")[5])
        skincolor_list.append(sg_file.split("/")[-1].split("_")[6])
        shirtcolor_list.append(sg_file.split("/")[-1].split("_")[7])
        action_list.append(sg_file.split("/")[-1].split("_")[8])

    df = pd.DataFrame(
        {
            'Filename': filename_list,
            'age_gt': age_list,
            'gender_gt': gender_list,
            'skin-color_gt': skincolor_list,
            'shirt-color_gt': shirtcolor_list,
            'action_gt': action_list,

        }
    )
    df = df.sort_values(['Filename'])
    df.to_csv(args.csv_outputs + "cityscapes_generated_gt_metadata_raw.csv")


def clean_up_gt_metadata(args):
    df = pd.read_csv(args.csv_outputs + "cityscapes_generated_gt_metadata_raw.csv")

    map_dict_column1 = {'old': 0, 'young': 1}
    map_dict_column2 = {'male': 1, 'female': 0,}
    map_dict_column3 = {'dark-skinned': 0, 'white-skinned': 1,}
    map_dict_column4 = {'red': 0, 'blue': 1, 'green': 2, 'black': 3, 'white': 4, 'brown': 5, 'grey': 6}
    map_dict_column5 = {'walking,': 0, 'running,': 1}

    # Applying the mapping
    df['age_gt'] = df['age_gt'].replace(map_dict_column1)
    df['gender_gt'] = df['gender_gt'].replace(map_dict_column2)
    df['skin-color_gt'] = df['skin-color_gt'].replace(map_dict_column3)
    df['shirt-color_gt'] = df['shirt-color_gt'].replace(map_dict_column4)
    df['action_gt'] = df['action_gt'].replace(map_dict_column5)

    df.to_csv(args.csv_outputs + "cityscapes_generated_gt_metadata_cleaned.csv")
