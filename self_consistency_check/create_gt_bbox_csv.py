import glob
import pandas as pd
import tqdm


def csv_gen(args):
    bbox_filepath = args.generated_mask_position_folder_path
    filenames = glob.glob(bbox_filepath + "*.txt")
    x1_list = []
    y1_list = []
    x2_list = []
    y2_list = []
    filename_list = []    
    for sg_file in tqdm.tqdm(filenames):
        with open(sg_file, 'r') as file:
            file_contents = file.read()
            filename_list.append('_'.join(sg_file.split("/")[-1].split("_")[0:4]).split(".")[0].split("-")[-1])
            try:
                x1_list.append(int(file_contents.split(",")[0]))
                y1_list.append(int(file_contents.split(",")[1].split("\n")[0]))
                x2_list.append((file_contents.split(",")[1].split("\n")[1]))
                y2_list.append(int(file_contents.split(",")[-1]))
            except:
                x1_list.append(-1)
                y1_list.append(-1)
                x2_list.append(-1)
                y2_list.append(-1)          

    df = pd.DataFrame(
        {
            'Filename': filename_list,
            'x1_list': x1_list,
            'y1_list': y1_list,
            'x2_list': x2_list,
            'y2_list': y2_list
        }
    )
    df = df.sort_values(['Filename'])
    df.to_csv(args.csv_outputs + "cityscapes_generated_gtbboxes.csv")
